<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kätkölöytöjen Yhteenveto Maakunnittain (Automaattisesti Päivittyvä)</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; margin: 20px; }
        h1, h2, h3 { color: #333; }
        .timestamp { margin-top: 5px; margin-bottom: 20px; font-size: 0.9em; color: #666; }
        .region { margin-bottom: 40px; padding: 20px; border: 1px solid #ccc; border-radius: 8px; background-color: #f0f0f0; }
        .region h2 { margin-top: 0; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .category { margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 5px; background-color: #f9f9f9; }
        .category h3 { margin-top: 0; margin-bottom: 10px; color: #555; }
        .kunta-list { list-style: inside; padding: 0; columns: 1; } /* Default to 1 column */
        /* Adjust column count based on screen width */
        @media (min-width: 600px) {
            .kunta-list {
                columns: 2;
            }
        }
         @media (min-width: 900px) {
            .kunta-list {
                columns: 3;
            }
        }
        .kunta-list li { margin-bottom: 5px; }
        #loading { font-size: 1.2em; color: #007BFF; }
        #error { font-size: 1.2em; color: #DC3545; }
    </style>
</head>
<body>
    <h1>Kätkölöytöjen Yhteenveto Maakunnittain</h1>
    <p class="timestamp" id="timestamp">Latautaan tietoja...</p>
    <div id="loading">Ladataan kuntatietoja...</div>
    <div id="error" style="display:none;">Tietojen lataaminen epäonnistui. Tarkista lähdetiedoston osoite ja internetyhteys.</div>
    <div id="content">
        </div>

    <script>
        const sourceUrl = 'https://mikkogeokalevi.github.io/triplettikunnat.html'; // TARKISTA TÄMÄ OSOITE!

        // Kartoitus kunnista maakuntiin
        const municipalityRegionMap = {
            'Akaa': 'Pirkanmaa',
            'Alajärvi': 'Etelä-Pohjanmaa',
            'Alavieska': 'Pohjois-Pohjanmaa',
            'Alavus': 'Etelä-Pohjanmaa',
            'Asikkala': 'Päijät-Häme',
            'Askola': 'Uusimaa',
            'Aura': 'Varsinais-Suomi',
            'Brändö': 'Ahvenanmaa',
            'Eckerö': 'Ahvenanmaa',
            'Enonkoski': 'Etelä-Savo',
            'Enontekiö': 'Lappi',
            'Espoo': 'Uusimaa',
            'Eura': 'Satakunta',
            'Eurajoki': 'Satakunta',
            'Evijärvi': 'Etelä-Pohjanmaa',
            'Finström': 'Ahvenanmaa',
            'Forssa': 'Kanta-Häme',
            'Föglö': 'Ahvenanmaa',
            'Geta': 'Ahvenanmaa',
            'Haapajärvi': 'Pohjois-Pohjanmaa',
            'Haapavesi': 'Pohjois-Pohjanmaa',
            'Hailuoto': 'Pohjois-Pohjanmaa',
            'Halsua': 'Keski-Pohjanmaa',
            'Hamina': 'Kymenlaakso',
            'Hammarland': 'Ahvenanmaa',
            'Hankasalmi': 'Keski-Suomi',
            'Hanko': 'Uusimaa',
            'Harjavalta': 'Satakunta',
            'Hartola': 'Päijät-Häme',
            'Hattula': 'Kanta-Häme',
            'Hausjärvi': 'Kanta-Häme',
            'Heinola': 'Päijät-Häme',
            'Heinävesi': 'Pohjois-Karjala', // Siirretty Pohjois-Karjalaan yleisen luokituksen mukaan
            'Helsinki': 'Uusimaa',
            'Hirvensalmi': 'Etelä-Savo',
            'Hollola': 'Päijät-Häme',
            'Huittinen': 'Pirkanmaa', // Siirretty Pirkanmaalle yleisen luokituksen mukaan
            'Humppila': 'Kanta-Häme',
            'Hyrynsalmi': 'Kainuu',
            'Hyvinkää': 'Uusimaa',
            'Hämeenkyrö': 'Pirkanmaa',
            'Hämeenlinna': 'Kanta-Häme',
            'Ii': 'Pohjois-Pohjanmaa',
            'Iisalmi': 'Pohjois-Savo',
            'Iitti': 'Kymenlaakso',
            'Ikaalinen': 'Pirkanmaa',
            'Ilmajoki': 'Etelä-Pohjanmaa',
            'Ilomantsi': 'Pohjois-Karjala',
            'Imatra': 'Etelä-Karjala',
            'Inari': 'Lappi',
            'Inkoo': 'Uusimaa',
            'Isojoki': 'Etelä-Pohjanmaa',
            'Isokyrö': 'Etelä-Pohjanmaa',
            'Janakkala': 'Kanta-Häme',
            'Joensuu': 'Pohjois-Karjala',
            'Jokioinen': 'Kanta-Häme',
            'Jomala': 'Ahvenanmaa',
            'Joroinen': 'Pohjois-Savo', // Siirretty Pohjois-Savoon yleisen luokituksen mukaan
            'Joutsa': 'Keski-Suomi',
            'Juuka': 'Pohjois-Karjala',
            'Juupajoki': 'Pirkanmaa',
            'Juva': 'Etelä-Savo',
            'Jyväskylä': 'Keski-Suomi',
            'Jämijärvi': 'Satakunta',
            'Jämsä': 'Keski-Suomi',
            'Järvenpää': 'Uusimaa',
            'Kaarina': 'Varsinais-Suomi',
            'Kaavi': 'Pohjois-Savo',
            'Kajaani': 'Kainuu',
            'Kalajoki': 'Pohjois-Pohjanmaa',
            'Kangasala': 'Pirkanmaa',
            'Kangasniemi': 'Etelä-Savo',
            'Kankaanpää': 'Satakunta',
            'Kannonkoski': 'Keski-Suomi',
            'Kannus': 'Keski-Pohjanmaa',
            'Karijoki': 'Etelä-Pohjanmaa',
            'Karkkila': 'Uusimaa',
            'Karstula': 'Keski-Suomi',
            'Karvia': 'Satakunta',
            'Kaskinen': 'Pohjanmaa',
            'Kauhajoki': 'Etelä-Pohjanmaa',
            'Kauhava': 'Etelä-Pohjanmaa',
            'Kauniainen': 'Uusimaa',
            'Kaustinen': 'Keski-Pohjanmaa',
            'Kemi': 'Lappi',
            'Kemijärvi': 'Lappi',
            'Keminmaa': 'Lappi',
            'Kempele': 'Pohjois-Pohjanmaa',
            'Kerava': 'Uusimaa',
            'Keitele': 'Pohjois-Savo',
            'Keuruu': 'Keski-Suomi',
            'Kihniö': 'Pirkanmaa',
            'Kinnula': 'Keski-Suomi',
            'Kirkkonummi': 'Uusimaa',
            'Kitee': 'Pohjois-Karjala',
            'Kittilä': 'Lappi',
            'Kiuruvesi': 'Pohjois-Savo',
            'Kivijärvi': 'Keski-Suomi',
            'Kokemäki': 'Satakunta',
            'Kokkola': 'Keski-Pohjanmaa',
            'Kolari': 'Lappi',
            'Konnevesi': 'Keski-Suomi',
            'Kontiolahti': 'Pohjois-Karjala',
            'Korsnäs': 'Pohjanmaa',
            'Koski Tl': 'Varsinais-Suomi',
            'Kotka': 'Kymenlaakso',
            'Kouvola': 'Kymenlaakso',
            'Kristiinankaupunki': 'Pohjanmaa',
            'Kruunupyy': 'Pohjanmaa',
            'Kuhmo': 'Kainuu',
            'Kuhmoinen': 'Keski-Suomi',
            'Kumlinge': 'Ahvenanmaa',
            'Kuopio': 'Pohjois-Savo',
            'Kuortane': 'Etelä-Pohjanmaa',
            'Kurikka': 'Etelä-Pohjanmaa',
            'Kustavi': 'Varsinais-Suomi',
            'Kuusamo': 'Pohjois-Pohjanmaa',
            'Kyyjärvi': 'Keski-Suomi',
            'Kärkölä': 'Päijät-Häme',
            'Kärsämäki': 'Pohjois-Pohjanmaa',
            'Kökar': 'Ahvenanmaa',
            'Lahti': 'Päijät-Häme',
            'Laihia': 'Pohjanmaa',
            'Laitila': 'Varsinais-Suomi',
            'Lapinjärvi': 'Uusimaa',
            'Lapinlahti': 'Pohjois-Savo',
            'Lappajärvi': 'Etelä-Pohjanmaa',
            'Lappeenranta': 'Etelä-Karjala',
            'Lapua': 'Etelä-Pohjanmaa',
            'Laukaa': 'Keski-Suomi',
            'Lemi': 'Etelä-Karjala',
            'Lemland': 'Ahvenanmaa',
            'Lempäälä': 'Pirkanmaa',
            'Leppävirta': 'Pohjois-Savo',
            'Lestijärvi': 'Keski-Pohjanmaa',
            'Lieksa': 'Pohjois-Karjala',
            'Lieto': 'Varsinais-Suomi',
            'Liminka': 'Pohjois-Pohjanmaa',
            'Liperi': 'Pohjois-Karjala',
            'Lohja': 'Uusimaa',
            'Loimaa': 'Varsinais-Suomi',
            'Loppi': 'Kanta-Häme',
            'Loviisa': 'Uusimaa',
            'Luhanka': 'Keski-Suomi',
            'Lumijoki': 'Pohjois-Pohjanmaa',
            'Lumparland': 'Ahvenanmaa',
            'Luoto': 'Pohjanmaa',
            'Luumäki': 'Etelä-Karjala',
            'Maalahti': 'Pohjanmaa',
            'Maarianhamina': 'Ahvenanmaa',
            'Marttila': 'Varsinais-Suomi',
            'Masku': 'Varsinais-Suomi',
            'Merijärvi': 'Pohjois-Pohjanmaa',
            'Merikarvia': 'Satakunta',
            'Miehikkälä': 'Kymenlaakso', // Siirretty Kymenlaaksoon yleisen luokituksen mukaan
            'Mikkeli': 'Etelä-Savo',
            'Muhos': 'Pohjois-Pohjanmaa',
            'Multia': 'Keski-Suomi',
            'Muurame': 'Keski-Suomi',
            'Myrskylä': 'Uusimaa',
            'Mynämäki': 'Varsinais-Suomi',
            'Mäntsälä': 'Uusimaa',
            'Mänttä-Vilppula': 'Pirkanmaa',
            'Naantali': 'Varsinais-Suomi',
            'Nakkila': 'Satakunta',
            'Närpiö': 'Pohjanmaa',
            'Nivala': 'Keski-Pohjanmaa', // Siirretty Keski-Pohjanmaalle
            'Nokia': 'Pirkanmaa',
            'Nousiainen': 'Varsinais-Suomi',
            'Nurmes': 'Pohjois-Karjala',
            'Nurmijärvi': 'Uusimaa',
            'Oripää': 'Varsinais-Suomi',
            'Orivesi': 'Pirkanmaa',
            'Oulainen': 'Pohjois-Pohjanmaa',
            'Oulu': 'Pohjois-Pohjanmaa',
            'Outokumpu': 'Pohjois-Karjala',
            'Padasjoki': 'Päijät-Häme',
            'Paimio': 'Varsinais-Suomi',
            'Paltamo': 'Kainuu',
            'Parainen': 'Varsinais-Suomi',
            'Parikkala': 'Etelä-Karjala',
            'Parkano': 'Pirkanmaa',
            'Pedersören kunta': 'Pohjanmaa',
            'Pelkosenniemi': 'Lappi',
            'Pello': 'Lappi',
            'Perho': 'Keski-Pohjanmaa',
            'Petäjävesi': 'Keski-Suomi',
            'Pieksämäki': 'Etelä-Savo',
            'Pielavesi': 'Pohjois-Savo',
            'Pietarsaari': 'Pohjanmaa',
            'Pihtipudas': 'Keski-Suomi',
            'Pirkkala': 'Pirkanmaa',
            'Polvijärvi': 'Pohjois-Karjala',
            'Pomarkku': 'Satakunta',
            'Pori': 'Satakunta',
            'Pornainen': 'Uusimaa',
            'Porvoo': 'Uusimaa',
            'Posio': 'Lappi',
            'Pudasjärvi': 'Pohjois-Pohjanmaa',
            'Pukkila': 'Uusimaa',
            'Punkalaidun': 'Pirkanmaa',
            'Puolanka': 'Kainuu',
            'Puumala': 'Etelä-Savo',
            'Pyhtää': 'Kymenlaakso',
            'Pyhäjoki': 'Pohjois-Pohjanmaa',
            'Pyhäjärvi': 'Pohjois-Pohjanmaa',
            'Pyhäntä': 'Pohjois-Pohjanmaa',
            'Pyhäranta': 'Satakunta', // Siirretty Satakuntaan yleisen luokituksen mukaan
            'Pälkäne': 'Pirkanmaa',
            'Pöytyä': 'Varsinais-Suomi',
            'Raahe': 'Pohjois-Pohjanmaa',
            'Raasepori': 'Uusimaa',
            'Raisio': 'Varsinais-Suomi',
            'Rantasalmi': 'Etelä-Savo',
            'Ranua': 'Lappi',
            'Rauma': 'Satakunta',
            'Rautalampi': 'Pohjois-Savo',
            'Rautavaara': 'Pohjois-Savo',
            'Rautjärvi': 'Etelä-Karjala',
            'Reisjärvi': 'Keski-Pohjanmaa', // Siirretty Keski-Pohjanmaalle
            'Riihimäki': 'Kanta-Häme',
            'Ristijärvi': 'Kainuu',
            'Rovaniemi': 'Lappi',
            'Ruokolahti': 'Etelä-Karjala',
            'Ruovesi': 'Pirkanmaa',
            'Rusko': 'Varsinais-Suomi',
            'Saarijärvi': 'Keski-Suomi',
            'Salla': 'Lappi',
            'Salo': 'Varsinais-Suomi',
            'Saltvik': 'Ahvenanmaa',
            'Sastamala': 'Pirkanmaa',
            'Sauvo': 'Varsinais-Suomi',
            'Savitaipale': 'Etelä-Karjala',
            'Savonlinna': 'Etelä-Savo',
            'Savukoski': 'Lappi',
            'Seinäjoki': 'Etelä-Pohjanmaa',
            'Sievi': 'Keski-Pohjanmaa', // Siirretty Keski-Pohjanmaalle
            'Siikainen': 'Satakunta',
            'Siikajoki': 'Pohjois-Pohjanmaa',
            'Siikalatva': 'Pohjois-Pohjanmaa',
            'Siilinjärvi': 'Pohjois-Savo',
            'Simo': 'Lappi',
            'Sipoo': 'Uusimaa',
            'Siuntio': 'Uusimaa',
            'Sodankylä': 'Lappi',
            'Soini': 'Etelä-Pohjanmaa',
            'Somero': 'Varsinais-Suomi',
            'Sonkajärvi': 'Pohjois-Savo',
            'Sotkamo': 'Kainuu', // Siirretty Kainuuseen
            'Sottunga': 'Ahvenanmaa',
            'Sulkava': 'Etelä-Savo',
            'Sund': 'Ahvenanmaa',
            'Suomussalmi': 'Kainuu',
            'Suonenjoki': 'Pohjois-Savo',
            'Sysmä': 'Päijät-Häme',
            'Säkylä': 'Satakunta',
            'Taipalsaari': 'Etelä-Karjala',
            'Taivalkoski': 'Lappi',
            'Taivassalo': 'Varsinais-Suomi',
            'Tammela': 'Kanta-Häme',
            'Tampere': 'Pirkanmaa',
            'Tervo': 'Pohjois-Savo',
            'Tervola': 'Lappi',
            'Teuva': 'Etelä-Pohjanmaa',
            'Tohmajärvi': 'Pohjois-Karjala',
            'Toholampi': 'Keski-Pohjanmaa',
            'Toivakka': 'Keski-Suomi',
            'Tornio': 'Lappi',
            'Turku': 'Varsinais-Suomi',
            'Tuusniemi': 'Pohjois-Savo',
            'Tuusula': 'Uusimaa',
            'Tyrnävä': 'Pohjois-Pohjanmaa',
            'Ulvila': 'Satakunta',
            'Urjala': 'Pirkanmaa', // Siirretty Pirkanmaalle
            'Utajärvi': 'Pohjois-Pohjanmaa',
            'Utsjoki': 'Lappi',
            'Uurainen': 'Keski-Suomi',
            'Uusikaarlepyy': 'Pohjanmaa',
            'Uusikaupunki': 'Varsinais-Suomi',
            'Vaala': 'Kainuu', // Siirretty Kainuuseen
            'Vaasa': 'Pohjanmaa',
            'Valkeakoski': 'Pirkanmaa',
            'Vantaa': 'Uusimaa',
            'Varkaus': 'Pohjois-Savo',
            'Vehmaa': 'Varsinais-Suomi',
            'Vesanto': 'Pohjois-Savo',
            'Vesilahti': 'Pirkanmaa',
            'Veteli': 'Keski-Pohjanmaa',
            'Vieremä': 'Pohjois-Savo',
            'Vihti': 'Uusimaa',
            'Viitasaari': 'Keski-Suomi',
            'Vimpeli': 'Etelä-Pohjanmaa',
            'Virolahti': 'Kymenlaakso', // Siirretty Kymenlaaksoon
            'Virrat': 'Pirkanmaa',
            'Vårdö': 'Ahvenanmaa',
            'Vöyri': 'Pohjanmaa',
            'Ylitornio': 'Lappi',
            'Ylivieska': 'Keski-Pohjanmaa', // Siirretty Keski-Pohjanmaalle
            'Ylöjärvi': 'Pirkanmaa',
            'Ypäjä': 'Kanta-Häme',
            'Ähtäri': 'Pirkanmaa', // Siirretty Pirkanmaalle
            'Äänekoski': 'Keski-Suomi'
        };


        async function fetchAndProcessData() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
             document.getElementById('timestamp').innerText = 'Ladataan tietoja...';
             document.getElementById('content').innerHTML = '';


            try {
                const response = await fetch(sourceUrl);
                if (!response.ok) {
                    // Log the status and text for debugging
                    console.error(`HTTP error! status: ${response.status}, text: ${await response.text()}`);
                    throw new Error(`HTTP status ${response.status}`);
                }
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const municipalities = {
                    'ei_loytoja': [],
                    'vain_tradi': [],
                    'vain_multi': [],
                    'vain_mysse': [],
                    'tradi_multi': [],
                    'multi_mysse': [],
                    'tradi_mysse': [],
                    'tradi_multi_mysse': []
                };

                // Extract timestamp
                const timestampElement = doc.querySelector('.timestamp');
                if(timestampElement) {
                    document.getElementById('timestamp').innerText = `Perustuu tiedostoon, ${timestampElement.innerText.trim()}`;
                } else {
                     document.getElementById('timestamp').innerText = `Perustuu tiedostoon (aikaleimaa ei löytynyt)`;
                }


                doc.querySelectorAll('.category').forEach(categoryDiv => {
                    const categoryTitle = categoryDiv.querySelector('h2').innerText.trim();
                    const kuntaList = categoryDiv.querySelectorAll('.kunta-list li');

                    let categoryKey = '';
                    if (categoryTitle.includes('EI OLE löytöjä')) {
                        categoryKey = 'ei_loytoja';
                    } else if (categoryTitle.includes('VAIN TRADI-löytöjä')) {
                        categoryKey = 'vain_tradi';
                    } else if (categoryTitle.includes('VAIN MULTI-löytöjä')) {
                         categoryKey = 'vain_multi';
                    } else if (categoryTitle.includes('VAIN MYSSE-löytöjä')) {
                        categoryKey = 'vain_mysse';
                    } else if (categoryTitle.includes('TRADI- ja MULTI-löytöjä')) {
                        categoryKey = 'tradi_multi';
                    } else if (categoryTitle.includes('MULTI- ja MYSSE-löytöjä')) {
                        categoryKey = 'multi_mysse';
                    } else if (categoryTitle.includes('TRADI- ja MYSSE-löytöjä')) {
                        categoryKey = 'tradi_mysse';
                    } else if (categoryTitle.includes('TRADI-, MULTI- ja MYSSE-löytöjä')) {
                        categoryKey = 'tradi_multi_mysse';
                    }

                    if (categoryKey) {
                         kuntaList.forEach(li => {
                            const kuntaNameMatch = li.innerText.match(/^[^:]+/); // Extract municipality name before ':'
                            if (kuntaNameMatch && kuntaNameMatch[0]) {
                                const kuntaName = kuntaNameMatch[0].trim();
                                municipalities[categoryKey].push(kuntaName);
                            }
                        });
                    }
                });

                 // Remove duplicates within each category just in case
                for (const category in municipalities) {
                    municipalities[category] = [...new Set(municipalities[category])];
                }


                const municipalitiesByRegionAndCategory = {};
                 const allMunicipalitiesInSource = new Set();

                for (const category in municipalities) {
                    municipalities[category].forEach(kunta => {
                         allMunicipalitiesInSource.add(kunta); // Track all municipalities found in the source
                        const region = municipalityRegionMap[kunta] || 'Tuntematon maakunta';
                        if (!municipalitiesByRegionAndCategory[region]) {
                            municipalitiesByRegionAndCategory[region] = {
                                'ei_loytoja': [],
                                'vain_tradi': [],
                                'vain_multi': [],
                                'vain_mysse': [],
                                'tradi_multi': [],
                                'multi_mysse': [],
                                'tradi_mysse': [],
                                'tradi_multi_mysse': []
                            };
                        }
                         // Prevent adding municipality to multiple categories within the same region (based on source classification)
                         let alreadyAdded = false;
                         for(const cat in municipalitiesByRegionAndCategory[region]) {
                             if(municipalitiesByRegionAndCategory[region][cat].includes(kunta)) {
                                 alreadyAdded = true;
                                 break;
                             }
                         }
                         if(!alreadyAdded) {
                              municipalitiesByRegionAndCategory[region][category].push(kunta);
                         }

                    });
                }

                 // Add municipalities with no finds from the map that were in the source
                 if(municipalities['ei_loytoja']) {
                     municipalities['ei_loytoja'].forEach(kunta => {
                          const region = municipalityRegionMap[kunta] || 'Tuntematon maakunta';
                            if (!municipalitiesByRegionAndCategory[region]) {
                                municipalitiesByRegionAndCategory[region] = {
                                    'ei_loytoja': [], 'vain_tradi': [], 'vain_multi': [], 'vain_mysse': [],
                                    'tradi_multi': [], 'multi_mysse': [], 'tradi_mysse': [], 'tradi_multi_mysse': []
                                };
                            }
                            let alreadyAdded = false;
                            for(const cat in municipalitiesByRegionAndCategory[region]) {
                                if(municipalitiesByRegionAndCategory[region][cat].includes(kunta)) {
                                    alreadyAdded = true;
                                    break;
                                }
                            }
                            if(!alreadyAdded) {
                                municipalitiesByRegionAndCategory[region]['ei_loytoja'].push(kunta);
                            }
                     });
                 }


                const contentDiv = document.getElementById('content');


                // Sort regions alphabetically
                const sortedRegions = Object.keys(municipalitiesByRegionAndCategory).sort();

                sortedRegions.forEach(region => {
                    const regionDiv = document.createElement('div');
                    regionDiv.classList.add('region');
                    contentDiv.appendChild(regionDiv);

                    const regionTitle = document.createElement('h2');
                    regionTitle.innerText = region;
                    regionDiv.appendChild(regionTitle);

                    const categoriesOrder = ['ei_loytoja', 'vain_tradi', 'vain_multi', 'vain_mysse', 'tradi_multi', 'multi_mysse', 'tradi_mysse', 'tradi_multi_mysse'];
                    const categoryTitles = {
                         'ei_loytoja': 'Kunnat, joista EI OLE löytöjä',
                        'vain_tradi': 'Kunnat, joista on VAIN TRADI-löytöjä',
                        'vain_multi': 'Kunnat, joista on VAIN MULTI-löytöjä',
                        'vain_mysse': 'Kunnat, joista on VAIN MYSSE-löytöjä',
                        'tradi_multi': 'Kunnat, joista on TRADI- ja MULTI-löytöjä',
                        'multi_mysse': 'Kunnat, joista on MULTI- ja MYSSE-löytöjä',
                        'tradi_mysse': 'Kunnat, joista on TRADI- ja MYSSE-löytöjä',
                        'tradi_multi_mysse': 'Kunnat, joista on TRADI-, MULTI- ja MYSSE-löytöjä'
                    };

                    categoriesOrder.forEach(categoryKey => {
                         const kuntaList = municipalitiesByRegionAndCategory[region][categoryKey];
                        if (kuntaList && kuntaList.length > 0) {
                            const categoryDiv = document.createElement('div');
                            categoryDiv.classList.add('category');
                            regionDiv.appendChild(categoryDiv);

                            const categoryTitle = document.createElement('h3');
                            categoryTitle.innerText = categoryTitles[categoryKey];
                            categoryDiv.appendChild(categoryTitle);

                            const ul = document.createElement('ul');
                            ul.classList.add('kunta-list');
                            kuntaList.sort().forEach(kunta => {
                                const li = document.createElement('li');
                                li.innerText = kunta;
                                ul.appendChild(li);
                            });
                            categoryDiv.appendChild(ul);
                        }
                    });
                });

                document.getElementById('loading').style.display = 'none';

            } catch (error) {
                console.error('Error fetching or processing data:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                 document.getElementById('timestamp').innerText = `Tietojen lataus epäonnistui`;
            }
        }

        fetchAndProcessData();
    </script>
</body>
</html>
