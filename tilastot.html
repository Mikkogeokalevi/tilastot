<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Geokätkötilastot</title> <style>
        body {
            margin: 0;
            /* padding-top will be set by JavaScript */
            font-family: sans-serif;
            background-color: #121212;
            color: #e0e0e0;
        }

        /* Style for the user input area - now fixed at the top */
        #userControlArea {
            position: fixed; /* Keep it fixed at the top */
            top: 0; /* Align to the very top */
            left: 0;
            width: 100%;
            box-sizing: border-box; /* Include padding in width */
            padding: 10px; /* Padding inside the area */
            background-color: #1f1f1f; /* Background to match nav */
            border-bottom: 1px solid #333; /* Separator line */
            z-index: 1000; /* Make sure it's above the nav */
            display: flex;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            align-items: center;
            gap: 10px; /* Space between items */
        }

        #userControlArea div {
             margin: 0; /* Remove default div margin */
         }

        /* Styles for the input and button */
        #usernameInput, #updateButton {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #555;
            background-color: #333;
            color: #fff;
            font-size: 14px;
        }

         #updateButton:hover {
            background-color: #005fa3;
        }

        nav {
            position: fixed; /* Keep it fixed */
            /* top will be set by JavaScript */
            left: 0;
            width: 100%;
            background-color: #1f1f1f;
            border-bottom: 1px solid #333;
            padding: 10px;
            box-sizing: border-box; /* Include padding in width */
            display: flex;
            flex-wrap: wrap; /* Allow items to wrap */
            align-items: center;
            z-index: 999; /* Below userControlArea but above content */
        }

        .nav-title {
            margin-right: 20px;
            font-weight: bold;
            font-size: 14px;
            color: #f0f0f0;
            white-space: nowrap;
        }

        .nav-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 0;
        }

         @media (max-width: 767px) {
            .nav-group {
                 margin-top: 10px; /* Add space if wrapping occurs */
                 width: 100%; /* Take full width */
            }
         }

        .nav-heading {
            font-weight: bold;
            font-size: 15px;
            color: #cccccc;
            margin: 0 10px;
            display: flex;
            align-items: center;
        }

        nav a {
            text-decoration: none;
            background-color: #333;
            color: #ffffff;
            font-weight: bold;
            font-size: 12px;
            padding: 6px 12px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        nav a:hover {
            background-color: #555;
        }

        nav a.active {
            background-color: #0077cc;
            color: white;
        }

        h2 {
            /* margin-top will be taken care of by body padding-top */
            margin: 40px 10px 5px; /* Reduced bottom margin to place link closer */
            font-size: 22px;
             /* scroll-margin-top will be set by JavaScript */
        }

        h3 {
            margin: 20px 10px 10px;
            font-size: 18px;
            color: #cccccc;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 0 20px 10px;
            border-radius: 5px;
        }

        h3 + img {
             margin-top: 10px;
        }

        .content-link {
            display: inline-block;
            margin: 10px;
            padding: 8px 14px;
            background-color: #0077cc;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .content-link:hover {
            background-color: #005fa3;
        }

        /* Style for the back-to-top link button placed after H2 */
        .back-to-top {
            /* Inherits content-link styles */
            display: inline-block; /* Keep it inline-block to flow after H2 */
            margin: 0 0 20px 10px; /* Adjust margin: top right bottom left */
            font-size: 12px; /* Slightly smaller font */
            vertical-align: middle; /* Align vertically with the heading */
        }


        .version {
            margin: 30px 10px 10px;
            font-size: 12px;
            color: #888;
            text-align: right;
        }
    </style>
</head>
<body id="top"> <div id="userControlArea">
         <div>
            Geokätkötilastot käyttäjälle: <span id="currentUsername">[Ei käyttäjää]</span> </div>
        <input type="text" id="usernameInput" value="" placeholder="Syötä käyttäjätunnus"> <button id="updateButton">Päivitä</button>
    </div>
    <nav>
        <div class="nav-title">Navigointi:</div> <div class="nav-group">
            <div class="nav-heading">*</div>
            <a href="#dt2025">T/D 2025</a>
            <a href="#dt">T/D full</a>
            <a href="#dt_month">T/D KK</a>
            <a href="#dt_day">T/D KK/PV PGC</a>
            <a href="#vvtyyp">VV / tyyppi</a>

            <div class="nav-heading">*</div>
            <a href="#paiva">Päivä läydöt</a>

            <div class="nav-heading">*</div>
            <a href="#kaikki">Vuosikalenterit</a>
            <a href="#maakunta">Maakunnat</a>

            <div class="nav-heading">*</div>
            <a href="#kuntakartta">Kuntakartat</a>
            <a href="#tripletti">Tripletti</a>
            <a href="#graticule">Graticule</a>
            <a href="#ftf">FTF</a>
            <a href="#miitti">Miitti</a>
            <a href="#isokunta">Iso</a>

            <div class="nav-heading">*</div>
            <a href="#jasmer">Jasmer</a>
        </div>
    </nav>

    <h2 id="dt2025">T/D 2025</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&year=2025">
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&year=2025&cachetype=1">
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&year=2025&cachetype=2">
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&year=2025&cachetype=3">
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&year=2025&cachetype=6">
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&year=2025&cachetype=7">


    <h2 id="dt">T/D full</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi">
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&cachetype=1">
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&cachetype=2">
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&cachetype=3">
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&cachetype=6">
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&cachetype=7">


    <h2 id="dt_month">T/D Kuukaudet</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <h3>Tammikuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=01">
    <h3>Helmikuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=02">
    <h3>Maaliskuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=03">
    <h3>Huhtikuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=04">
    <h3>Toukokuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=05">
    <h3>Kesäkuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=06">
    <h3>Heinäkuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=07">
    <h3>Elokuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=08">
    <h3>Syyskuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=09">
    <h3>Lokakuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=10">
    <h3>Marraskuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=11">
    <h3>Joulukuu</h3>
    <img data-src="https://www.geocache.fi/stat/matrix.php?la=&user=mikkokalevi&month=12">


    <h2 id="dt_day">T/D kk/päivät PGC</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <a class="content-link" href="https://project-gc.com/Challenges//76983" target="_blank">Linkki chekkeriin</a>


    <h2 id="vvtyyp">Löydöt vuosi / tyyppi</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <img data-src="https://www.geocache.fi/stat/yeartype.php?la=&user=mikkokalevi">


    <h2 id="paiva">Päivä läydöt</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <img data-src="https://www.geocache.fi/stat/day.php?la=&user=mikkokalevi">


    <h2 id="kaikki">Vuosikalenterit</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <img data-src="http://www.geocache.fi/stat/year.php?&user=mikkokalevi">
    <img data-src="http://www.geocache.fi/stat/year.php?&user=mikkokalevi&year=2025">
    <img data-src="http://www.geocache.fi/stat/year.php?&user=mikkokalevi&cachetype=1">
    <img data-src="http://www.geocache.fi/stat/year.php?&user=mikkokalevi&cachetype=2">
    <img data-src="http://www.geocache.fi/stat/year.php?&user=mikkokalevi&cachetype=3">
    <img data-src="http://www.geocache.fi/stat/year.php?&user=mikkokalevi&cachetype=4">
    <img data-src="http://www.geocache.fi/stat/year.php?&user=mikkokalevi&cachetype=99">
    <img data-src="http://www.geocache.fi/stat/year.php?&user=mikkokalevi&cachetype=7">
    <img data-src="http://www.geocache.fi/stat/year.php?&user=mikkokalevi&cachetype=9">
    <img data-src="http://www.geocache.fi/stat/year.php?&user=mikkokalevi&cachetype=20">


    <h2 id="maakunta">Maakunnat</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <h3>Päijät-häme</h3>
    <img data-src="https://www.geocache.fi/stat/year.php?&user=mikkokalevi&mkunta=P%C3%A4ij%C3%A4t-H%C3%A4me">
    <h3>Kymenlaakso</h3>
    <img data-src="https://www.geocache.fi/stat/year.php?&user=mikkokalevi&mkunta=kymenlaakso">
    <h3>Kanta-häme</h3>
    <img data-src="https://www.geocache.fi/stat/year.php?&user=mikkokalevi&mkunta=Kanta-H%C3%A4me">
    <h3>Varsinais-Suomi</h3>
    <img data-src="https://www.geocache.fi/stat/year.php?&user=mikkokalevi&mkunta=Varsinais-Suomi">
    <h3>Uusimaa</h3>
    <img data-src="https://www.geocache.fi/stat/year.php?&user=mikkokalevi&mkunta=Uusimaa">


    <h2 id="kuntakartta">Kuntakartat</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <img data-src="https://www.geocache.fi/stat/kunta.php?la=&slide=1&user=mikkokalevi">
    <a class="content-link" data-href="https://www.geocache.fi/stat/kunta/?user=mikkokalevi&names=1" target="_blank">Yleis kartta</a>
    <img data-src="https://www.geocache.fi/stat/kunta.php?la=&slide=1&user=mikkokalevi&cachetype=1">
    <a class="content-link" data-href="https://www.geocache.fi/stat/kunta/?user=mikkokalevi&names=1&cachetype=1" target="_blank">Tradi kartta</a>
    <img data-src="https://www.geocache.fi/stat/kunta.php?la=&slide=1&user=mikkokalevi&cachetype=2">
    <a class="content-link" data-href="https://www.geocache.fi/stat/kunta/?user=mikkokalevi&names=1&cachetype=2" target="_blank">Multi kartta</a>
    <img data-src="https://www.geocache.fi/stat/kunta.php?la=&slide=1&user=mikkokalevi&cachetype=3">
    <a class="content-link" data-href="https://www.geocache.fi/stat/kunta/?user=mikkokalevi&names=1&cachetype=3" target="_blank">Mysse kartta</a>
    <img data-src="https://www.geocache.fi/stat/kunta.php?la=&slide=1&user=mikkokalevi&cachetype=6">
    <a class="content-link" data-href="https://www.geocache.fi/stat/kunta/?user=mikkokalevi&names=1&cachetype=6" target="_blank">Öörtti kartta</a>
    <img data-src="https://www.geocache.fi/stat/kunta.php?la=&slide=1&user=mikkokalevi&cachetype=7">
    <a class="content-link" data-href="https://www.geocache.fi/stat/kunta/?user=mikkokalevi&names=1&cachetype=7" target="_blank">Virtu kartta</a>


    <h2 id="tripletti">Tripletti kuntakartta</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <img data-src="https://www.geocache.fi/stat/kunta.php?la=&user=mikkokalevi&slide=0&cachetype=90">
    <a class="content-link" data-href="https://www.geocache.fi/stat/kunta/?user=mikkokalevi&names=1&cachetype=90" target="_blank">Tripletti kartta</a>

    <h2 id="graticule">Graticule</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <img data-src="https://www.geocache.fi/stat/grat.php?la=&user=mikkokalevi">

    <h2 id="ftf">FTF Kuntakartta</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <img data-src="https://www.geocache.fi/stat/ftfkunta.php?la=&slide=1&user=mikkokalevi">


    <h2 id="miitti">Miitti Kuntakartta</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <img data-src="https://www.geocache.fi/stat/kunta.php?la=&slide=1&user=mikkokalevi&cachetype=99">


    <h2 id="isokunta">Iso kuntakartta</h2><a href="#top" class="content-link back-to-top">Takaisin ylös</a>
    <a class="content-link" data-href="https://www.geocache.fi/stat/kunta/?user=mikkokalevi&names=1" target="_blank">ISO kuntakartta linkeillä</a>


    <h2 id="jasmer">Jasmer</h2> <img data-src="https://www.geocache.fi/stat/hiddenday.php?la=&type=2&user=mikkokalevi">
    <a class="content-link" data-href="https://www.geocache.fi/stat/hiddenday.php?la=&user=mikkokalevi&type=2&cachetype=1" target="_blank">Jasmer tradi</a>
    <a class="content-link" data-href="https://www.geocache.fi/stat/hiddenday.php?la=&user=mikkokalevi&type=2&cachetype=2" target="_blank">Jasmer multi</a>
    <a class="content-link" data-href="https://www.geocache.fi/stat/hiddenday.php?la=&user=mikkokalevi&type=2&cachetype=3" target="_blank">Jasmer mysse</a>


    <div class="version">Versio 30</div>

    <br><br><br><br><br>

    <script>
        const sections = document.querySelectorAll("h2[id]");
        const navLinks = document.querySelectorAll("nav a");
        const userControlArea = document.getElementById('userControlArea');
        const navBar = document.querySelector('nav');
        const usernameInput = document.getElementById('usernameInput');
        const updateButton = document.getElementById('updateButton');
        const currentUsernameSpan = document.getElementById('currentUsername');
        const h2Elements = document.querySelectorAll('h2');


        // Function to adjust padding and margins based on fixed header heights
        function adjustLayout() {
            const userAreaHeight = userControlArea.offsetHeight;
            const navHeight = navBar.offsetHeight;
            const totalFixedHeight = userAreaHeight + navHeight;

            // Set the top position of the nav bar
            navBar.style.top = userAreaHeight + 'px';

            // Set padding-top for the body to push content below fixed headers
            document.body.style.paddingTop = totalFixedHeight + 'px';

            // Set scroll-margin-top for H2 elements to account for fixed headers when jumping
            h2Elements.forEach(h2 => {
                h2.style.scrollMarginTop = totalFixedHeight + 'px';
            });
        }


        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute("id");
                    navLinks.forEach(link => {
                        link.classList.toggle("active", link.getAttribute("href") === "#" + id);
                    });
                }
            });
        }, {
             /* rootMargin needs to be dynamic or large enough for max fixed height */
             /* We'll set scroll-margin-top dynamically, so this margin can be simpler */
             rootMargin: "-50px 0px -60% 0px", /* Keep a reasonable margin */
             threshold: 0.1
        });

        sections.forEach(section => {
            observer.observe(section);
        });

        // --- JavaScript for username update ---

        function updateStats(username) {
            // Trim whitespace from the username
            const cleanUsername = username.trim();

            // Handle empty username case
            if (!cleanUsername) {
                console.warn("Username is empty after trimming, skipping update.");
                // Update the span to indicate empty username
                if (currentUsernameSpan) {
                   currentUsernameSpan.textContent = "[Tyhjä]";
                }
                // Clear loaded images/links when username becomes empty
                document.querySelectorAll('img[src], a[href]').forEach(element => {
                    // Only clear elements that were loaded by the script (i.e., have data attributes)
                    if (element.tagName === 'IMG' && element.hasAttribute('data-src')) {
                         element.removeAttribute('src'); // Remove src to hide image
                    } else if (element.tagName === 'A' && element.hasAttribute('data-href')) {
                         // For links, revert the href to the base data-href value without a user or disable it.
                         let baseHref = element.getAttribute('data-href');
                         if(baseHref && baseHref.includes('user=')) {
                             element.href = baseHref.replace(/user=([^&]+)/, 'user=');
                         } else if (baseHref) {
                              // If the original data-href didn't have a user param but has href, remove it
                             element.removeAttribute('href');
                         }
                     }
                });
                 return; // Stop the function here
            }

            // Update the visible username in the user control area
            if (currentUsernameSpan) {
                currentUsernameSpan.textContent = cleanUsername;
            }


            // Select all elements that have data-src or data-href attributes
            const elementsToUpdate = document.querySelectorAll('img[data-src], a[data-href]');

            // Regex to find 'user=' followed by characters until '&' or end of string
            const userParamRegex = /user=([^&]+)/;

            elementsToUpdate.forEach(element => {
                let originalUrl;
                let urlAttribute;

                if (element.tagName === 'IMG' && element.hasAttribute('data-src')) {
                    originalUrl = element.getAttribute('data-src');
                    urlAttribute = 'src';
                } else if (element.tagName === 'A' && element.hasAttribute('data-href')) {
                    originalUrl = element.getAttribute('data-href');
                    urlAttribute = 'href';
                } else {
                    return; // Skip elements without data-src/data-href or other types
                }

                // Ensure the url exists and contains 'user='
                if (originalUrl && originalUrl.includes('user=')) {
                    // Replace the existing username with the new username using regex
                    const newUrl = originalUrl.replace(userParamRegex, 'user=' + encodeURIComponent(cleanUsername));

                    // Update the attribute. This triggers the browser to load the resource.
                    element[urlAttribute] = newUrl;
                } else if (originalUrl) {
                    // If the data attribute exists but doesn't contain 'user=',
                    // just set the src/href from the data attribute.
                     element[urlAttribute] = originalUrl;
                }
            });
        }

        // Event listener for the button click
        updateButton.addEventListener('click', () => {
            const username = usernameInput.value; // Get value from input field
            updateStats(username); // Call the update function
        });

        // Event listener for the input field (Enter key)
        usernameInput.addEventListener('keypress', (event) => {
            // Check if the pressed key is Enter
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent default form submission if any
                const username = usernameInput.value; // Get value from input field
                updateStats(username); // Call the update function
            }
        });

        // --- Layout Adjustments ---
        // Adjust layout on initial load and window resize
        document.addEventListener('DOMContentLoaded', adjustLayout);
        window.addEventListener('resize', adjustLayout);


        // Initial state on page load:
        // - The input field is empty (value="").
        // - The currentUsernameSpan shows "[Ei käyttäjää]".
        // - No images/links with data-src/data-href are loaded automatically.

    </script>

</body>
</html>
